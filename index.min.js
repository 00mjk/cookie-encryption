/*
 * cookie-encryption v1.0.3
 * (c) hex7c0 http://supergiovane.tk/#/cookie-encryption
 * Licensed under GPLv3
 */
"use strict";function SIGNED(a){this.my=a,this.cookie=a.cookie,this.encoding=a.encoding,this.cache={read:new Object,write:new Object},this.customization(!0)}function NORMAL(a){this.my=a,this.cookie=a.cookie,this.encoding=a.encoding,this.cache={read:new Object,write:new Object},this.customization(!1)}try{var arc4,autokey,crypto=require("crypto"),getCiphers=[["arc4","rc4a","vmpc","rc4+"],crypto.getCiphers()]}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}SIGNED.prototype.customization=NORMAL.prototype.customization=function(a){var b=this.my;if("autokey"===b.cipher)autokey||(autokey=require("autokey")),this.cipher=autokey(b.secret),this.encrypt=function(a,b){if("string"==typeof a)return"s"+this.cipher.encodeString(a,"utf8",b||this.encoding);if(Buffer.isBuffer(a))return"b"+this.cipher.encodeBuffer(a).toString(b||this.encoding);throw new TypeError("Not a string or buffer")},this.decrypt=function(a,b){if("s"===a[0]){var c=a.substring(1,a.length);return this.cipher.decodeString(c,b||this.encoding)}if("b"===a[0]){var c=a.substring(1,a.length);return new Buffer(this.cipher.decodeString(c,b||this.encoding))}throw new TypeError("Not a string or buffer")};else if(getCiphers[0].indexOf(b.cipher)>=0)arc4||(arc4=require("arc4")),this.cipher=arc4(b.cipher,b.secret),this.encrypt=function(a,b){if("string"==typeof a)return"s"+this.cipher.encodeString(a,"utf8",b||this.encoding);if(Buffer.isBuffer(a))return"b"+this.cipher.encodeBuffer(a).toString(b||this.encoding);throw new TypeError("Not a string or buffer")},this.decrypt=function(a,b){if("s"===a[0]){var c=a.substring(1,a.length);return this.cipher.decodeString(c,b||this.encoding)}if("b"===a[0]){var c=a.substring(1,a.length);return new Buffer(this.cipher.decodeString(c,b||this.encoding))}throw new TypeError("Not a string or buffer")};else{if(!(getCiphers[1].indexOf(b.cipher)>=0))throw new TypeError("Cipher not supported");this.encrypt=function(a,c){var d=crypto.createCipher(b.cipher,b.secret);return d.update(a,"utf8"),d.final(c||this.encoding)},this.decrypt=function(a,c){var d=crypto.createDecipher(b.cipher,b.secret);return d.update(a,c||this.encoding),d.final("utf8")}}this.set=function(b,c,d){var e=this.my;return b.cookie(d||this.cookie,c,{domain:e.domain,path:e.path,maxAge:e.age,httpOnly:e.httpOnly,secure:e.secure,signed:a}),c}},SIGNED.prototype.read=function(a,b,c){var d;return void 0!==a.signedCookies&&(d=a.signedCookies[b||this.cookie])?this.cache.read[d]?this.cache.read[d]:(this.cache.read=new Object,this.cache.read[d]=this.decrypt(d,c)):""},NORMAL.prototype.read=function(a,b,c){var d;return void 0!==a.cookies&&(d=a.cookies[b||this.cookie])?this.cache.read[d]?this.cache.read[d]:(this.cache.read=new Object,this.cache.read[d]=this.decrypt(d,c)):""},SIGNED.prototype.write=function(a,b,c,d){var e,f=c||this.cookie;if(this.cache.write[b]?e=this.cache.write[b]:(this.cache.write=new Object,e=this.cache.write[b]=this.encrypt(b,d)),a.signedCookies[f]!==e){var g=a.res;a.signedCookies[f]=this.set(g,e,c)}return e},NORMAL.prototype.write=function(a,b,c,d){var e,f=c||this.cookie;if(this.cache.write[b]?e=this.cache.write[b]:(this.cache.write=new Object,e=this.cache.write[b]=this.encrypt(b,d)),a.cookies[f]!==e){var g=a.res;a.cookies[f]=this.set(g,e,c)}return e},module.exports=function(a,b){if(!a)throw new TypeError("secret required");var b=b||Object.create(null),c={secret:String(a),cipher:String(b.cipher||"arc4"),cookie:String(b.cookie||"vault"),domain:String(b.domain||""),path:String(b.path||"/"),age:Number(b.age)||31536e6,httpOnly:Boolean(b.httpOnly),secure:Boolean(b.secure),signed:Boolean(b.signed),encoding:String(b.encoding||"hex")};return Boolean(b.signed)?new SIGNED(c):new NORMAL(c)};
