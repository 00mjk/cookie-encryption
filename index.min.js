/*
 * cookie-encryption v1.0.0
 * (c) hex7c0 http://supergiovane.tk/#/cookie-encryption
 * Licensed under GPLv3
 */
"use strict";function SIGNED(a){if(this.my=a,this.ck=a.cookie,this.ee=a.encoding,this.cache={read:{},write:{}},["arc4","rc4a","vmpc","rc4+"].indexOf(a.cipher)>=0)this.cipher=arc4(a.cipher,a.secret),this.encrypt=function(a){return this.cipher.encodeString(a,"utf8",this.ee)},this.decrypt=function(a){return this.cipher.decodeString(a,this.ee)};else if("autokey"===a.cipher)this.cipher=autokey(a.secret),this.encrypt=function(a){return this.cipher.encodeString(a,"utf8",this.ee)},this.decrypt=function(a){return this.cipher.decodeString(a,this.ee)};else{if(!(crypto.getCiphers().indexOf(a.cipher)>=0))throw new TypeError("cipher not supported");this.encrypt=function(b){var c=crypto.createCipher(a.cipher,a.secret);return c.update(b,"utf8"),c.final(this.ee)},this.decrypt=function(b){var c=crypto.createDecipher(a.cipher,a.secret);return c.update(b,this.ee),c.final("utf8")}}this.set=function(b,c){return a=this.my,b.cookie(this.ck,c,{domain:a.domain,path:a.path,maxAge:a.age,httpOnly:a.httpOnly,secure:a.secure,signed:!0}),c}}function NORMAL(a){if(this.my=a,this.ck=a.cookie,this.ee=a.encoding,this.cache={read:{},write:{}},["arc4","rc4a","vmpc","rc4+"].indexOf(a.cipher)>=0)this.cipher=arc4(a.cipher,a.secret),this.encrypt=function(a){return this.cipher.encodeString(a,"utf8",this.ee)},this.decrypt=function(a){return this.cipher.decodeString(a,this.ee)};else if("autokey"===a.cipher)this.cipher=autokey(a.secret),this.encrypt=function(a){return this.cipher.encodeString(a,"utf8",this.ee)},this.decrypt=function(a){return this.cipher.decodeString(a,this.ee)};else{if(!(crypto.getCiphers().indexOf(a.cipher)>=0))throw new TypeError("cipher not supported");this.encrypt=function(b){var c=crypto.createCipher(a.cipher,a.secret);return c.update(b,"utf8"),c.final(this.ee)},this.decrypt=function(b){var c=crypto.createDecipher(a.cipher,a.secret);return c.update(b,this.ee),c.final("utf8")}}this.set=function(a,b){var c=this.my;return a.cookie(this.ck,b,{domain:c.domain,path:c.path,maxAge:c.age,httpOnly:c.httpOnly,secure:c.secure,signed:!1}),b}}try{var arc4=require("arc4"),autokey=require("autokey"),crypto=require("crypto")}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}SIGNED.prototype.read=function(a){var b;if(void 0===a.signedCookies||!(b=a.signedCookies[this.ck]))return"";try{return this.cache.read[b]?this.cache.read[b]:this.cache.read[b]=this.decrypt(b)}catch(c){return""}},NORMAL.prototype.read=function(a){var b;if(void 0===a.cookies||!(b=a.cookies[this.ck]))return"";try{return this.cache.read[b]?this.cache.read[b]:this.cache.read[b]=this.decrypt(b)}catch(c){return""}},SIGNED.prototype.write=function(a,b){var c;if(c=this.cache.write[b]?this.cache.write[b]:this.cache.write[b]=this.encrypt(b),a.signedCookies[this.ck]!==c){var d=a.res;a.signedCookies[this.ck]=this.set(d,c)}return c},NORMAL.prototype.write=function(a,b){var c;if(c=this.cache.write[b]?this.cache.write[b]:this.cache.write[b]=this.encrypt(b),a.cookies[this.ck]!==c){var d=a.res;a.cookies[this.ck]=this.set(d,c)}return c},module.exports=function(a,b){if(!a)throw new TypeError("secret required");var b=b||Object.create(null),c={secret:String(a),cipher:String(b.cipher||"arc4"),cookie:String(b.cookie||"vault"),domain:String(b.domain||""),path:String(b.path||"/"),age:Number(b.age)||31536e6,httpOnly:Boolean(b.httpOnly),secure:Boolean(b.secure),signed:Boolean(b.signed),encoding:String(b.encoding||"hex")};return Boolean(b.signed)?new SIGNED(c):new NORMAL(c)};
