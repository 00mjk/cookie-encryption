/*
 * cookie-encryption v1.0.2
 * (c) hex7c0 http://supergiovane.tk/#/cookie-encryption
 * Licensed under GPLv3
 */
"use strict";function SIGNED(a){this.my=a,this.cookie=a.cookie,this.encoding=a.encoding,this.cache={read:{},write:{}},this.customization(!0)}function NORMAL(a){this.my=a,this.cookie=a.cookie,this.encoding=a.encoding,this.cache={read:new Array(""),write:new Array("")},this.customization(!1)}try{var arc4,autokey,crypto=require("crypto"),getCiphers=[["arc4","rc4a","vmpc","rc4+"],crypto.getCiphers()]}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}SIGNED.prototype.customization=NORMAL.prototype.customization=function(a){var b=this.my;if("autokey"===b.cipher)autokey||(autokey=require("autokey")),this.cipher=autokey(b.secret),this.encrypt=function(a){return this.cipher.encode(a,"utf8",this.encoding)},this.decrypt=function(a){return this.cipher.decode(a,this.encoding)};else if(getCiphers[0].indexOf(b.cipher)>=0)arc4||(arc4=require("arc4")),this.cipher=arc4(b.cipher,b.secret),this.encrypt=function(a){return this.cipher.encode(a,"utf8",this.encoding)},this.decrypt=function(a){return this.cipher.decode(a,this.encoding)};else{if(!(getCiphers[1].indexOf(b.cipher)>=0))throw new TypeError("cipher not supported");this.encrypt=function(a){var c=crypto.createCipher(b.cipher,b.secret);return c.update(a,"utf8"),c.final(this.encoding)},this.decrypt=function(a){var c=crypto.createDecipher(b.cipher,b.secret);return c.update(a,this.encoding),c.final("utf8")}}this.set=function(b,c){var d=this.my;return b.cookie(this.cookie,c,{domain:d.domain,path:d.path,maxAge:d.age,httpOnly:d.httpOnly,secure:d.secure,signed:a}),c}},SIGNED.prototype.read=function(a){var b;if(void 0===a.signedCookies||!(b=a.signedCookies[this.cookie]))return"";try{return this.cache.read[0]===b?this.cache.read[0]:this.cache.read[0]=this.decrypt(b)}catch(c){return""}},NORMAL.prototype.read=function(a){var b;if(void 0===a.cookies||!(b=a.cookies[this.cookie]))return"";try{return this.cache.read[0]===b?this.cache.read[0]:this.cache.read[0]=this.decrypt(b)}catch(c){return""}},SIGNED.prototype.write=function(a,b){var c;if(c=this.cache.write[0]===b?this.cache.write[0]:this.cache.write[0]=this.encrypt(b),a.signedCookies[this.cookie]!==c){var d=a.res;a.signedCookies[this.cookie]=this.set(d,c)}return c},NORMAL.prototype.write=function(a,b){var c;if(c=this.cache.write[0]===b?this.cache.write[0]:this.cache.write[0]=this.encrypt(b),a.cookies[this.cookie]!==c){var d=a.res;a.cookies[this.cookie]=this.set(d,c)}return c},module.exports=function(a,b){if(!a)throw new TypeError("secret required");var b=b||Object.create(null),c={secret:String(a),cipher:String(b.cipher||"arc4"),cookie:String(b.cookie||"vault"),domain:String(b.domain||""),path:String(b.path||"/"),age:Number(b.age)||31536e6,httpOnly:Boolean(b.httpOnly),secure:Boolean(b.secure),signed:Boolean(b.signed),encoding:String(b.encoding||"hex")};return Boolean(b.signed)?new SIGNED(c):new NORMAL(c)};
