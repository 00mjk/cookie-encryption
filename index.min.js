"use strict";function SIGNED(a){this._my=a,this.cookie=a.cookie,this.encoding=a.encoding,this.decrypt=null,this.encrypt=null,this._cipher=null,this.customization(!0),this.cache={read:new Object(null),write:new Object(null)}}function NORMAL(a){this._my=a,this.cookie=a.cookie,this.encoding=a.encoding,this.decrypt=null,this.encrypt=null,this._cipher=null,this.customization(!1),this.cache={read:new Object(null),write:new Object(null)}}function cookiee(a,b){if(!a)throw new TypeError("secret required");var c=b||Object.create(null),d={secret:Buffer.isBuffer(a)?a:new Buffer(a),cipher:String(c.cipher||"arc4"),cookie:String(c.cookie||"vault"),domain:String(c.domain||""),path:String(c.path||"/"),age:Number(c.age)||31536e6,httpOnly:Boolean(c.httpOnly),secure:Boolean(c.secure),signed:Boolean(c.signed),encoding:String(c.encoding||"hex"),extra:Array.isArray(c.extra)===!0?c.extra:[]};return Boolean(c.signed)?new SIGNED(d):new NORMAL(d)}try{var arc4=null,autokey=null,crypto=require("crypto"),getCipher=new Array(["arc4","rc4a","vmpc","rc4+"],crypto.getCiphers(),crypto.getHashes(),["modp1","modp2","modp5","modp14","modp15","modp16","modp17","modp18"],["pbkdf2"],["autokey"])}catch(MODULE_NOT_FOUND){console.error(MODULE_NOT_FOUND),process.exit(1)}SIGNED.prototype.customization=NORMAL.prototype.customization=function(a){var b=this._my;if(b.cipher===getCipher[4][0])this.encrypt=function(a,c){return crypto.pbkdf2Sync(b.cipher,b.extra[0],b.extra[1],b.extra[2]).toString(c||this.encoding)},this.decrypt=function(){throw new TypeError("Pbkdf2 not supported")};else if(b.cipher===getCipher[5][0])null===autokey&&(autokey=require("autokey")),this._cipher=autokey(b.secret),this.encrypt=function(a,b){if("string"==typeof a)return this._cipher.encodeString(a,"utf8",b||this.encoding);if(Buffer.isBuffer(a))return this._cipher.encodeBuffer(a).toString(b||this.encoding);throw new TypeError("Not a string or buffer")},this.decrypt=function(a,b){if("string"==typeof a)return this._cipher.decodeString(a,b||this.encoding);throw new TypeError("Not a string or buffer")};else if(getCipher[0].indexOf(b.cipher)>=0)null===arc4&&(arc4=require("arc4")),this._cipher=arc4(b.cipher,b.secret),this.encrypt=function(a,b){if("string"==typeof a)return this._cipher.encodeString(a,"utf8",b||this.encoding);if(Buffer.isBuffer(a))return this._cipher.encodeBuffer(a).toString(b||this.encoding);throw new TypeError("Not a string or buffer")},this.decrypt=function(a,b){if("string"==typeof a)return this._cipher.decodeString(a,b||this.encoding);throw new TypeError("Not a string or buffer")};else if(getCipher[1].indexOf(b.cipher)>=0)this.encrypt=function(a,c){var d=crypto.createCipher(b.cipher,b.secret);return d.update(a)+d.final(c||this.encoding)},this.decrypt=function(a,c){var d=crypto.createDecipher(b.cipher,b.secret);return d.update(a,c||this.encoding)+d.final()};else if(getCipher[2].indexOf(b.cipher)>=0)void 0===b.extra[0]?(this.encrypt=function(a,c){var d=crypto.createHash(b.cipher);return d.update(a).digest(c||this.encoding)},this.decrypt=function(){throw new TypeError("Hash not supported")}):(this.encrypt=function(a,c){var d=crypto.createHmac(b.cipher,b.secret);return d.update(a).digest(c||this.encoding)},this.decrypt=function(){throw new TypeError("Hmac not supported")});else{if(!(getCipher[3].indexOf(b.cipher)>=0))throw new TypeError("Cipher not supported");this.encrypt=function(a,c){var d=crypto.getDiffieHellman(b.cipher);return d.generateKeys().toString(c||this.encoding)},this.decrypt=function(){throw new TypeError("DiffieHellman not supported")}}this.set=function(b,c,d){var e=this._my;return b.cookie(d||this.cookie,c,{domain:e.domain,path:e.path,maxAge:e.age,httpOnly:e.httpOnly,secure:e.secure,signed:a}),c}},SIGNED.prototype.read=function(a,b,c){var d,e;return void 0===a.signedCookies||void 0===(d=a.signedCookies[b||this.cookie])?"":(void 0===(e=this.cache.read[d])&&(e=this.cache.read[d]=this.decrypt(d,c)),e)},NORMAL.prototype.read=function(a,b,c){var d,e;return void 0===a.cookies||void 0===(d=a.cookies[b||this.cookie])?"":(void 0===(e=this.cache.read[d])&&(e=this.cache.read[d]=this.decrypt(d,c)),e)},SIGNED.prototype.write=function(a,b,c,d){var e,f=c||this.cookie;if(this.cache.write[b]?e=this.cache.write[b]:(this.cache.write=new Object(null),e=this.cache.write[b]=this.encrypt(b,d)),a.signedCookies[f]!==e){var g=a.res;a.signedCookies[f]=this.set(g,e,c)}return e},NORMAL.prototype.write=function(a,b,c,d){var e,f=c||this.cookie;if(this.cache.write[b]?e=this.cache.write[b]:(this.cache.write=new Object(null),e=this.cache.write[b]=this.encrypt(b,d)),a.cookies[f]!==e){var g=a.res;a.cookies[f]=this.set(g,e,c)}return e},module.exports=cookiee,module.exports.getCiphers=function(){return getCipher};
